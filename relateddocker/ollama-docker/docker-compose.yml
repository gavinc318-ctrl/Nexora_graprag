services:
  ollama:
    image: ollama/ollama:latest
    container_name: ollama
    restart: unless-stopped
    gpus: all
    ports:
      - "11434:11434"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              device_ids: ["1"]     # 只给 GPU1（3050）
              capabilities: [gpu]
    volumes:
      - ollama:/root/.ollama

    # 只暴露宿主机 GPU 1 给容器
    environment:
      - NVIDIA_VISIBLE_DEVICES=1
      - CUDA_VISIBLE_DEVICES=1
      # 可选：有些框架会用这个
      - NVIDIA_DRIVER_CAPABILITIES=compute,utility

    # ✅ 关键：明确让它一直跑 serve
    command: ["serve"]

volumes:
  ollama:
